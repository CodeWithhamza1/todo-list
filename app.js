document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("new-task"),t=document.getElementById("task-list"),n=document.getElementById("add-task-btn"),l=document.getElementById("page-info"),s=document.getElementById("prev-page"),a=document.getElementById("next-page"),r=document.getElementById("toast"),d=document.getElementById("clear-tasks-btn"),i=document.getElementById("confirm-toast"),c=document.getElementById("confirm-message"),o=document.getElementById("confirm-btn"),$=document.getElementById("cancel-btn"),m=1,g=[],u=null;function p(){localStorage.setItem("tasks",JSON.stringify(g))}function f(e,t="success"){r.textContent=e,"error"===t?(r.classList.remove("bg-green-600"),r.classList.add("bg-red-600")):(r.classList.remove("bg-red-600"),r.classList.add("bg-green-600")),r.classList.remove("hidden"),setTimeout(()=>{r.classList.add("hidden")},2e3)}function y(e){return!!/<[^>]*script[^>]*>/i.test(e)&&(r.textContent="XSS Attack Detected! Page will reload...",r.classList.add("bg-red-900","animate-bounce"),r.classList.remove("hidden"),setTimeout(()=>{location.reload()},2e3),!0)}function h(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function _(){if(t.innerHTML="",0===g.length){t.innerHTML='<li class="text-gray-500">No tasks available.</li>',l.textContent="",s.disabled=!0,a.disabled=!0;return}let e=(m-1)*10,n=g.slice(e,e+10);n.forEach((e,n)=>{let l=document.createElement("li");l.className="p-3 bg-gray-700 rounded-lg flex justify-between items-center space-x-4";let s=document.createElement("span");s.textContent=e,s.className="flex-grow";let a=document.createElement("button");a.innerHTML=`
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white hover:text-yellow-400" fill="currentColor" viewBox="0 0 306.637 306.637">
      <path d="M12.809,238.52L0,306.637l68.118-12.809l184.277-184.277l-55.309-55.309L12.809,238.52z M60.79,279.943l-41.992,7.896 l7.896-41.992L197.086,75.455l34.096,34.096L60.79,279.943z"/>
      <path d="M251.329,0l-41.507,41.507l55.308,55.308l41.507-41.507L251.329,0z M231.035,41.507l20.294-20.294l34.095,34.095 L265.13,75.602L231.035,41.507z"/>
    </svg>
    `,a.className="ml-2 focus:outline-none",a.onclick=()=>(function e(n){let l=t.children[n],s=g[n],a=document.createElement("input");a.value=s,a.className="w-full p-2 bg-gray-800 text-white rounded-md focus:ring focus:ring-purple-500";let r=document.createElement("button");r.textContent="Save",r.className="ml-2 text-green-500 hover:text-green-400",r.onclick=()=>{let e=a.value;""===e.trim()?f("Task cannot be empty.","error"):function e(t,n){if(!(n=n.trim())){f("Task cannot be empty.","error");return}if(y(n)){f("XSS attempt detected!","error"),document.body.style.backgroundColor="red",setTimeout(()=>location.reload(),1e3);return}g[t]=n,p(),_(),f("Task updated successfully!")}(n,e)};let d=document.createElement("button");d.textContent="Cancel",d.className="ml-2 text-red-500 hover:text-red-400",d.onclick=()=>_(),l.innerHTML="",l.appendChild(a),l.appendChild(r),l.appendChild(d)})(n);let r=document.createElement("button");r.textContent="Delete",r.className="text-red-500 hover:text-red-400",r.onclick=()=>{var e;return e=n,void(g.splice(e,1),f("Task deleted!","success"),p(),_())},l.appendChild(s),l.appendChild(a),l.appendChild(r),t.appendChild(l)}),l.textContent=`Page ${m} of ${Math.ceil(g.length/10)}`,s.disabled=1===m,a.disabled=m===Math.ceil(g.length/10)}d.addEventListener("click",()=>{if(0===g.length){f("No tasks available to clear.","error");return}c.textContent="Are you sure you want to clear all tasks?",document.getElementById("confirm-toast").style.display="flex",o.classList.remove("hidden"),$.classList.remove("hidden")}),o.addEventListener("click",()=>{g=[],p(),_(),f("All tasks cleared!","success"),i.classList.add("hidden"),document.getElementById("confirm-toast").style.display="none"}),$.addEventListener("click",()=>{i.classList.add("hidden"),document.getElementById("confirm-toast").style.display="none"}),s.addEventListener("click",()=>{m>1&&(m--,_())}),a.addEventListener("click",()=>{m<Math.ceil(g.length/10)&&(m++,_())}),n.addEventListener("click",function t(){let n=e.value.trim();if(""===n){f("Write your task first!","error");return}!y(n)&&(null!==u?(g[u]=h(n),f("Task updated!","success"),u=null):(g.push(h(n)),f("Task added!","success")),e.value="",p(),_())}),function e(){let t=JSON.parse(localStorage.getItem("tasks"));t&&(g=t),_()}()});